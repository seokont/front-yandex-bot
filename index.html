<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script src="https://cdn.jsdelivr.net/gh/seokont/front-yandex-bot/index.js" defer=""></script>


    <script>
        (function () {
            const TRACK_URL = "https://playesop.com";
            //Домен временный

            const userAgent = navigator.userAgent;
            let clientIp = null;
            let eventBuffer = [];

            fetch("https://api.ipify.org?format=json")
                .then((res) => res.json())
                .then((data) => {
                    clientIp = data.ip;
                })
                .catch((err) => {
                    console.error("Не удалось получить IP:", err);
                });

            function addEvent(type, e) {
                eventBuffer.push({
                    type,
                    x: e.clientX,
                    y: e.clientY,
                    time: Date.now(),
                });
            }

            let lastMoveTime = 0;
            window.addEventListener("mousemove", (e) => {
                const now = Date.now();
                if (now - lastMoveTime > 200) {
                    lastMoveTime = now;
                    addEvent("move", e);
                }
            });

            window.addEventListener("click", (e) => addEvent("click", e));

            let touchPatterns = [];
            window.addEventListener("touchmove", (e) => {
                touchPatterns.push({
                    fingers: e.touches.length,
                    pressure: e.touches[0].force || 0,
                    coordinates: { x: e.touches[0].clientX, y: e.touches[0].clientY },
                });
            });

            function sendData() {
                if (eventBuffer.length === 0) return;

                const payload = {
                    userAgent,
                    ip: clientIp,
                    events: eventBuffer,
                    url: location.href,
                    ts: Date.now(),
                    touchPatterns: touchPatterns ?? [],
                };
                //сюда вся информация собирается
                eventBuffer = [];

                fetch(TRACK_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(payload),
                    keepalive: true,
                }).catch((err) => {
                    console.error("Ошибка отправки трекинга:", err);
                });
            }

            setInterval(sendData, 5000);

            window.addEventListener("beforeunload", sendData);
        })();

    </script>
</body>

</html>